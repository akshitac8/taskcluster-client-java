<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Taskcluster-client-java by taskcluster</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Taskcluster-client-java</h1>
      <h2 class="project-tagline">A java client for interfacing with taskcluster server components</h2>
      <a href="https://github.com/taskcluster/taskcluster-client-java" class="btn">View on GitHub</a>
      <a href="https://github.com/taskcluster/taskcluster-client-java/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/taskcluster/taskcluster-client-java/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="taskcluster-client-java" class="anchor" href="#taskcluster-client-java" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>taskcluster-client-java</h1>

<p><img hspace="20" align="left" src="https://tools.taskcluster.net/lib/assets/taskcluster-120.png">
<a href="https://maven-badges.herokuapp.com/maven-central/org.mozilla.taskcluster/taskcluster-client/"><img src="https://maven-badges.herokuapp.com/maven-central/org.mozilla.taskcluster/taskcluster-client/badge.svg" alt="Maven Central"></a>
<a href="http://travis-ci.org/taskcluster/taskcluster-client-java"><img src="https://travis-ci.org/taskcluster/taskcluster-client-java.svg?branch=master" alt="Build Status"></a>
<a href="http://taskcluster.github.io/taskcluster-client-java/apidocs"><img src="https://img.shields.io/badge/javadoc-reference-blue.svg" alt="JavaDoc"></a>
<a href="https://coveralls.io/github/taskcluster/taskcluster-client-java?branch=master"><img src="https://coveralls.io/repos/taskcluster/taskcluster-client-java/badge.svg?branch=master&amp;service=github" alt="Coverage Status"></a>
<a href="http://mozilla.org/MPL/2.0"><img src="https://img.shields.io/badge/license-MPL%202.0-orange.svg" alt="License"></a></p>

<p>A java port of taskcluster-client.</p>

<h2>
<a id="http-apis" class="anchor" href="#http-apis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>HTTP APIs</h2>

<ul>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/auth/Auth.html">Auth</a><br>
Authentication related API end-points for taskcluster.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/awsprovisioner/AwsProvisioner.html">AWS Provisioner</a><br>
The AWS Provisioner is responsible for provisioning instances on EC2 for use in TaskCluster.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/github/Github.html">Github</a><br>
The Github service is responsible for publishing pulse messages for supported Github events.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/hooks/Hooks.html">Hooks</a><br>
Hooks are a mechanism for creating tasks in response to events.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/index/Index.html">Index</a><br>
The task index is responsible for indexing tasks.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/login/Login.html">Login</a><br>
The Login service serves as the interface between external authentication systems and TaskCluster credentials.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/notify/Notify.html">Notify</a><br>
The notification service listens for tasks with associated notifications and sends them.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/purgecache/PurgeCache.html">Purge Cache</a><br>
The purge-cache service is responsible for publishing a pulse message for workers, so they can purge cache upon request.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/queue/Queue.html">Queue</a><br>
The queue is responsible for accepting tasks and track their state as they are executed by workers.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/scheduler/Scheduler.html">Scheduler</a><br>
The task-graph scheduler is responsible for accepting task-graphs and scheduling tasks for evaluation by the queue as their dependencies are satisfied.</p></li>
<li><p><a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/secrets/Secrets.html">Secrets</a><br>
The secrets service is responsible for managing secure data in TaskCluster.</p></li>
</ul>

<h3>
<a id="amqp-apis" class="anchor" href="#amqp-apis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AMQP APIs</h3>

<p>Currently AMQP APIs are not supported in the java client.</p>

<h3>
<a id="client-utilities" class="anchor" href="#client-utilities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Client utilities</h3>

<ul>
<li>
<a href="http://taskcluster.github.io/taskcluster-client-java/apidocs/org/mozilla/taskcluster/client/Credentials.html">Credentials</a><br>
For credentials operations, such as:

<ul>
<li>Creating temporary credentials from permanent credentials</li>
<li>Limiting credentials to a set of authorized scopes</li>
</ul>
</li>
</ul>

<h2>
<a id="using" class="anchor" href="#using" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using</h2>

<h3>
<a id="maven" class="anchor" href="#maven" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Maven</h3>

<p>In order to use this library from your maven project, simply include it as a project dependency:</p>

<pre><code>&lt;project&gt;
  ...
  &lt;dependencies&gt;
    ...
    &lt;dependency&gt;
      &lt;groupId&gt;org.mozilla.taskcluster&lt;/groupId&gt;
      &lt;artifactId&gt;taskcluster-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>

<p>The taskcluster-client artifacts are now available from the <a href="http://central.sonatype.org/">maven central repository</a>:</p>

<ul>
<li><a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.mozilla.taskcluster%22%20AND%20a%3A%22taskcluster-client%22">Search Results</a></li>
<li><a href="https://repo1.maven.org/maven2/org/mozilla/taskcluster/taskcluster-client/">Directory Listing</a></li>
</ul>

<h2>
<a id="calling-api-end-points" class="anchor" href="#calling-api-end-points" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calling API End-Points</h2>

<p>To invoke an API end-point, instantiate one of the HTTP API classes (from
section <a href="#http-apis">HTTP APIs</a>).  In the following example we instantiate an
instance of the <code>Queue</code> client class and use it to create a task.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.*</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.queue.*</span>;

<span class="pl-c1">...</span>

    <span class="pl-c">// Create credentials, e.g. from environment variables...</span>
    <span class="pl-smi">Credentials</span> creds <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Credentials</span>(
        <span class="pl-smi">System</span><span class="pl-k">.</span>getenv(<span class="pl-s"><span class="pl-pds">"</span>TASKCLUSTER_CLIENT_ID<span class="pl-pds">"</span></span>),
        <span class="pl-smi">System</span><span class="pl-k">.</span>getenv(<span class="pl-s"><span class="pl-pds">"</span>TASKCLUSTER_ACCESS_TOKEN<span class="pl-pds">"</span></span>),
        <span class="pl-smi">System</span><span class="pl-k">.</span>getenv(<span class="pl-s"><span class="pl-pds">"</span>TASKCLUSTER_CERTIFICATE<span class="pl-pds">"</span></span>)
    );

    <span class="pl-c">// Instantiate the Queue client class</span>
    <span class="pl-smi">Queue</span> queue <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Queue</span>(creds);

    <span class="pl-c">// Supply a unique task name</span>
    <span class="pl-smi">String</span> taskId <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>;

    <span class="pl-c">// Define the task</span>
    <span class="pl-smi">TaskDefinition</span> td <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">TaskDefinition</span>();

    <span class="pl-c">// Set properties, as required...</span>
    td<span class="pl-k">.</span>created <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">java.util<span class="pl-k">.</span>Date</span>();
    td<span class="pl-k">.</span>provisionerId <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>;
    td<span class="pl-k">.</span>routes <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">String</span>[] { <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span> };
    <span class="pl-smi">td<span class="pl-k">.</span>XYZ</span> <span class="pl-k">=</span> <span class="pl-c1">...</span>

    <span class="pl-c">// Execute the API call</span>
    <span class="pl-k">try</span> {
        <span class="pl-smi">TaskStatusResponse</span> tsr <span class="pl-k">=</span> queue<span class="pl-k">.</span>defineTask(taskId, td)<span class="pl-k">.</span>responsePayload;

        <span class="pl-c">// Process API response</span>
        <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>State is <span class="pl-pds">"</span></span> <span class="pl-k">+</span> tsr<span class="pl-k">.</span>status<span class="pl-k">.</span>state);

    } <span class="pl-k">catch</span> (<span class="pl-smi">APICallFailure</span> e) {
        <span class="pl-c">// handle exception ...</span>
    }

<span class="pl-c1">...</span></pre></div>

<h2>
<a id="temporary-credentials" class="anchor" href="#temporary-credentials" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Temporary credentials</h2>

<p>You can generate temporary credentials from permanent credentials using the
java client. This may be useful if you wish to issue credentials to a third
party. See <a href="https://docs.taskcluster.net/manual/apis/temporary-credentials">https://docs.taskcluster.net/manual/apis/temporary-credentials</a> for
more information. Both named and unnamed temporary credentials are supported,
although named credentials are preferred if you are not sure which type to use.</p>

<h3>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example</h3>

<div class="highlight highlight-source-java"><pre><span class="pl-k">package</span> <span class="pl-smi">org.mozilla.taskcluster</span>;

<span class="pl-k">import</span> <span class="pl-smi">java.util.Date</span>;

<span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.APICallFailure</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.CallSummary</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.Credentials</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.EmptyPayload</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.InvalidOptionsException</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.queue.ListArtifactsResponse</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.queue.ListArtifactsResponse.Artifacts</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.mozilla.taskcluster.client.queue.Queue</span>;

<span class="pl-c">/**</span>
<span class="pl-c"> * This simple demo lists the artifacts in run 0 of task U7On2dUVS9KlEgw7LUaCMQ.</span>
<span class="pl-c"> * It creates permanent credentials from environment variables</span>
<span class="pl-c"> * TASKCLUSTER_CLIENT_ID and TASKCLUSTER_ACCESS_TOKEN, and then creates</span>
<span class="pl-c"> * temporary credentials, valid for 24 hours, from these permanent credentials.</span>
<span class="pl-c"> * It queries the Queue using the temporary credentials, and with limited</span>
<span class="pl-c"> * authorized scopes.</span>
<span class="pl-c"> *</span>
<span class="pl-c"> * Note, the queue.listArtifacts(...) call doesn't require any scopes, the</span>
<span class="pl-c"> * generation of temporary credentials, and limiting via authorized scopes is</span>
<span class="pl-c"> * purely illustrative. The TASKCLUSTER_CLIENT_ID must satisfy</span>
<span class="pl-c"> * auth:create-client:demo-client/taskcluster-client-java, though.</span>
<span class="pl-c"> */</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Demo</span> {
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">main</span>(<span class="pl-k">String</span>[] <span class="pl-v">args</span>) {
        <span class="pl-smi">Credentials</span> permCreds <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Credentials</span>(
            <span class="pl-smi">System</span><span class="pl-k">.</span>getenv(<span class="pl-s"><span class="pl-pds">"</span>TASKCLUSTER_CLIENT_ID<span class="pl-pds">"</span></span>),
            <span class="pl-smi">System</span><span class="pl-k">.</span>getenv(<span class="pl-s"><span class="pl-pds">"</span>TASKCLUSTER_ACCESS_TOKEN<span class="pl-pds">"</span></span>)
        );
        <span class="pl-smi">Date</span> now <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Date</span>();
        <span class="pl-k">try</span> {
            <span class="pl-smi">Credentials</span> tempCreds <span class="pl-k">=</span> permCreds<span class="pl-k">.</span>createTemporaryCredentials(
                <span class="pl-s"><span class="pl-pds">"</span>demo-client/taskcluster-client-java<span class="pl-pds">"</span></span>,
                <span class="pl-k">new</span> <span class="pl-smi">String</span>[] {
                    <span class="pl-s"><span class="pl-pds">"</span>assume:legacy-permacred<span class="pl-pds">"</span></span>
                },
                <span class="pl-c">// valid immediately</span>
                now,
                <span class="pl-c">// expire in 24 hours</span>
                <span class="pl-k">new</span> <span class="pl-smi">Date</span>(now<span class="pl-k">.</span>getTime() <span class="pl-k">+</span> <span class="pl-c1">1000</span> <span class="pl-k">*</span> <span class="pl-c1">60</span> <span class="pl-k">*</span> <span class="pl-c1">60</span> <span class="pl-k">*</span> <span class="pl-c1">24</span>)
            );
            tempCreds<span class="pl-k">.</span>authorizedScopes <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">String</span>[] { <span class="pl-s"><span class="pl-pds">"</span>queue:get-artifact:private/build/*<span class="pl-pds">"</span></span> };
            <span class="pl-smi">Queue</span> queue <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Queue</span>(tempCreds);
            <span class="pl-k">CallSummary&lt;<span class="pl-smi">EmptyPayload</span>, <span class="pl-smi">ListArtifactsResponse</span>&gt;</span> cs <span class="pl-k">=</span> queue<span class="pl-k">.</span>listArtifacts(<span class="pl-s"><span class="pl-pds">"</span>U7On2dUVS9KlEgw7LUaCMQ<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span>);
            <span class="pl-smi">ListArtifactsResponse</span> artifacts <span class="pl-k">=</span> cs<span class="pl-k">.</span>responsePayload;
            <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Artifacts:<span class="pl-pds">"</span></span>);
            <span class="pl-k">for</span> (<span class="pl-smi">Artifacts</span> artifact <span class="pl-k">:</span> artifacts<span class="pl-k">.</span>artifacts) {
                <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>  * <span class="pl-pds">"</span></span> <span class="pl-k">+</span> artifact<span class="pl-k">.</span>name);
            }
            <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Done.<span class="pl-pds">"</span></span>);
        } <span class="pl-k">catch</span> (<span class="pl-smi">InvalidOptionsException</span> e) {
            <span class="pl-smi">System</span><span class="pl-k">.</span>err<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Could not create temporary credentials<span class="pl-pds">"</span></span>);
            e<span class="pl-k">.</span>printStackTrace();
        } <span class="pl-k">catch</span> (<span class="pl-smi">APICallFailure</span> e) {
            <span class="pl-smi">System</span><span class="pl-k">.</span>err<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Could not query the Queue service<span class="pl-pds">"</span></span>);
            e<span class="pl-k">.</span>printStackTrace();
        }
    }
}</pre></div>

<p>See the <a href="#http-apis">HTTP API javadocs</a> for more information, or browse the <a href="https://github.com/taskcluster/taskcluster-client-java/tree/master/src/test/java/org/mozilla/taskcluster">unit
tests</a>
for further examples.</p>

<h2>
<a id="building" class="anchor" href="#building" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Building</h2>

<p>The java libraries provided by this client are auto-generated in
<a href="https://golang.org/">go</a> (not java!) using the schemas defined in
<a href="http://references.taskcluster.net/manifest.json">http://references.taskcluster.net/manifest.json</a> combined with supplementary
information stored in
<a href="https://github.com/taskcluster/taskcluster-client-java/blob/master/codegenerator/model/apis.json">apis.json</a>.</p>

<p><a href="https://godoc.org/github.com/taskcluster/taskcluster-client-java"><img src="https://godoc.org/github.com/taskcluster/taskcluster-client-java?status.svg" alt="GoDoc"></a></p>

<p>In order to completely regenerate all of the HTTP and AMQP libraries, please run
<a href="https://github.com/taskcluster/taskcluster-client-java/blob/master/build.sh">build.sh</a>
found in the top level directory. This will completely regenerate the library.
Please note you will need an active internet connection as the build process
must download several json files and schemas in order to build the library. The
code generation requires go (golang) is installed on your system, and java, and
apache maven. All three need to be setup and configured correctly.</p>

<p>The code which generates the library can all be found under the top level
<a href="https://github.com/taskcluster/taskcluster-client-java/tree/master/codegenerator">codegenerator</a>
directory.</p>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributing</h2>

<p>Contributions are welcome. Please fork, and issue a Pull Request back with an
explanation of your changes.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/taskcluster/taskcluster-client-java">Taskcluster-client-java</a> is maintained by <a href="https://github.com/taskcluster">taskcluster</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
